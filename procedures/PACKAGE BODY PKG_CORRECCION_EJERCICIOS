
CREATE OR REPLACE
PACKAGE BODY PKG_CORRECCION_EJERCICIOS AS

PROCEDURE PR_CORREGIR_EJERCICIOS(ID_EJER IN EJERCICIO.ID_EJERCICIO%TYPE, ANSWER IN RESPUESTA.RESPUESTA%TYPE,DNI IN RESPUESTA.DNI_ALUMNO%TYPE) AS
VAR_CONT NUMBER;
VAR_EJERCICIO EJERCICIO.SOLUCION%TYPE;
  BEGIN
    SELECT EJERCICIO.SOLUCION INTO VAR_EJERCICIO FROM EJERCICIO WHERE ID_EJERCICIO = ID_EJER;
    DBMS_OUTPUT.PUT_LINE('CREATE OR REPLACE VIEW CORRECCION AS (('|| VAR_EJERCICIO || ' MINUS ' || ANSWER || ') UNION (' ||ANSWER|| ' MINUS ' || VAR_EJERCICIO || '))');
  EXECUTE IMMEDIATE  'CREATE OR REPLACE VIEW CORRECCION AS (('|| VAR_EJERCICIO || ' MINUS ' || ANSWER || ') UNION (' ||ANSWER|| ' MINUS ' || VAR_EJERCICIO || '))' ;
  SELECT COUNT(*) INTO VAR_CONT FROM CORRECCION ;
  IF VAR_CONT = 0 THEN
  UPDATE RESPUESTA SET SUBMITTED_AT = SYSDATE WHERE RESPUESTA.ID_EJERCICIO = ID_EJERCICIO AND RESPUESTA.DNI_ALUMNO = DNI;
    DBMS_OUTPUT.PUT_LINE('RESPUESTA CORRECTA');
  END IF;
  
  END PR_CORREGIR_EJERCICIOS;
  
END PKG_CORRECCION_EJERCICIOS;
